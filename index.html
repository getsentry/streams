<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Design principles &#8212; Sentry Streams 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=2709fde1"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The rationale" href="what_for.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>Sentry Streams is a distributed platform that, like most streaming platforms,
is designed to handle real-time unbounded data streams.</p>
<p>This is built primarily to allow the creation of Sentry ingestion pipelines
though the api provided is fully independent from the Sentry product and can
be used to build any streaming application.</p>
<p>The main features are:</p>
<ul class="simple">
<li><p>Kafka sources and multiple sinks. Ingestion pipeline take data from Kafka
and write enriched data into multiple data stores.</p></li>
<li><p>Dataflow API support. This allows the creation of streaming application
focusing on the application logic and pipeline topology rather than
the underlying dataflow engine.</p></li>
<li><p>Support for stateful and stateless transformations. The state storage is
provided by the platform rather than being part of the application.</p></li>
<li><p>Distributed execution. The primitives used to build the application can
be distributed on multiple nodes by configuration.</p></li>
<li><p>Hide the Kafka details from the application. Like commit policy and topic
partitioning.</p></li>
<li><p>Out of the box support for some streaming applications best practices:
DLQ, monitoring, health checks, etc.</p></li>
<li><p>Support for Rust and Python applications.</p></li>
<li><p>Support for multiple runtimes.</p></li>
</ul>
<section id="design-principles">
<h1>Design principles<a class="headerlink" href="#design-principles" title="Link to this heading">¶</a></h1>
<p>This streaming platform, in the context of Sentry ingestion, is designed
with a few principles in mind:</p>
<ul class="simple">
<li><p>Fully self service to speed up the time to reach production when building pipelines.</p></li>
<li><p>Abstract infrastructure aspect away (Kafka, delivery guarantees, schemas, scale, etc.) to improve stability and scale.</p></li>
<li><p>Opinionated in the abstractions provided to build ingestion to push for best practices and to hide the inner working of streaming applications.</p></li>
<li><p>Pipeline as a system for tuning, capacity management and architecture understanding</p></li>
</ul>
</section>
<section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading">¶</a></h1>
<p>In order to build a streaming application and run it on top of the Sentry Arroyo
runtime, follow these steps:</p>
<ol class="arabic simple">
<li><p>Run locally a Kafka broker.</p></li>
<li><p>Create a new Python project and a dev environment.</p></li>
<li><p>Import sentry streams</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">sentry_streams</span>
</pre></div>
</div>
<p>For local development, instead of using pip, install the package from the source code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">install</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Create a new Python module for your streaming application, or use one of the examples from the <cite>sentry_streams/examples</cite> folder:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_kafka_schemas.schema_types.ingest_metrics_v1</span><span class="w"> </span><span class="kn">import</span> <span class="n">IngestMetric</span>
<span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_streams.pipeline.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parser</span><span class="p">,</span> <span class="n">Serializer</span>
<span class="linenos"> 3</span><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_streams.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">streaming_source</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="n">pipeline</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 6</span>    <span class="n">streaming_source</span><span class="p">(</span>
<span class="linenos"> 7</span>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myinput&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span>        <span class="n">stream_name</span><span class="o">=</span><span class="s2">&quot;ingest-metrics&quot;</span><span class="p">,</span>
<span class="linenos"> 9</span>    <span class="p">)</span>
<span class="linenos">10</span>    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Parser</span><span class="p">[</span><span class="n">IngestMetric</span><span class="p">](</span><span class="s2">&quot;parse_msg&quot;</span><span class="p">))</span>
<span class="linenos">11</span>    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Serializer</span><span class="p">(</span><span class="s2">&quot;serializer&quot;</span><span class="p">))</span>
<span class="linenos">12</span>    <span class="o">.</span><span class="n">sink</span><span class="p">(</span>
<span class="linenos">13</span>        <span class="n">StreamSink</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;mysink&quot;</span><span class="p">,</span> <span class="n">stream_name</span><span class="o">=</span><span class="s2">&quot;transformed-events&quot;</span><span class="p">),</span>
<span class="linenos">14</span>    <span class="p">)</span>
<span class="linenos">15</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a simple pipeline that takes a stream of JSON messages that fits the schema of the “ingest-metrics” topic (from sentry-kafka-schema), parses them,
casts them to the message type IngestMetric object, and serializes them back to JSON and produces the result to another topic.</p>
<p>Note that if these topics don’t exist, they will need to be created. With docker:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="o">&lt;</span><span class="n">YOUR</span> <span class="n">KAFKA</span> <span class="n">CONTAINER</span> <span class="n">NAME</span><span class="o">&gt;</span> <span class="n">kafka</span><span class="o">-</span><span class="n">topics</span> <span class="o">--</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">server</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">9092</span> <span class="o">--</span><span class="n">create</span> <span class="o">--</span><span class="n">topic</span> <span class="n">ingest</span><span class="o">-</span><span class="n">metrics</span> <span class="o">--</span><span class="n">partitions</span> <span class="mi">1</span> <span class="o">--</span><span class="n">replication</span><span class="o">-</span><span class="n">factor</span> <span class="mi">1</span>
<span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="o">&lt;</span><span class="n">YOUR</span> <span class="n">KAFKA</span> <span class="n">CONTAINER</span> <span class="n">NAME</span><span class="o">&gt;</span> <span class="n">kafka</span><span class="o">-</span><span class="n">topics</span> <span class="o">--</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">server</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">9092</span> <span class="o">--</span><span class="n">create</span> <span class="o">--</span><span class="n">topic</span> <span class="n">transformed</span><span class="o">-</span><span class="n">events</span> <span class="o">--</span><span class="n">partitions</span> <span class="mi">1</span> <span class="o">--</span><span class="n">replication</span><span class="o">-</span><span class="n">factor</span> <span class="mi">1</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Run the pipeline</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SEGMENT_ID</span><span class="o">=</span><span class="mi">0</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sentry_streams</span><span class="o">.</span><span class="n">runner</span> \
<span class="o">-</span><span class="n">n</span> <span class="n">Batch</span> \
<span class="o">--</span><span class="n">config</span> <span class="n">sentry_streams</span><span class="o">/</span><span class="n">deployment_config</span><span class="o">/&lt;</span><span class="n">YOUR</span> <span class="n">CONFIG</span> <span class="n">FILE</span><span class="o">&gt;.</span><span class="n">yaml</span> \
<span class="o">--</span><span class="n">adapter</span> <span class="n">rust</span><span class="o">-</span><span class="n">arroyo</span> \
<span class="o">--</span><span class="n">segment</span><span class="o">-</span><span class="nb">id</span> <span class="mi">0</span> \
<span class="o">&lt;</span><span class="n">YOUR</span> <span class="n">PIPELINE</span> <span class="n">FILE</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>for the above code example, use <cite>sentry_streams/sentry_streams/deployment_config/simple_map_filter.yaml</cite> for the deployment config file (assuming you have two local Kafka topics for source and sink)</p>
<ol class="arabic simple" start="6">
<li><p>Produce events on the <cite>ingest-metrics</cite> topic and consume them from the <cite>transformed-events</cite> topic.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;{&quot;org_id&quot;: 420, &quot;project_id&quot;: 420, &quot;name&quot;: &quot;c:sessions/session@none&quot;, &quot;tags&quot;: </span><span class="si">{}</span><span class="s1">, &quot;timestamp&quot;: 1111111111111111, &quot;retention_days&quot;: 90, &quot;type&quot;: &quot;c&quot;, &quot;value&quot;: 1}&#39;</span> <span class="o">|</span> <span class="n">kcat</span> <span class="o">-</span><span class="n">b</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> <span class="o">-</span><span class="n">P</span> <span class="o">-</span><span class="n">t</span> <span class="n">ingest</span><span class="o">-</span><span class="n">metrics</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kcat</span> <span class="o">-</span><span class="n">b</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">9092</span> <span class="o">-</span><span class="n">G</span> <span class="n">test</span> <span class="n">transformed</span><span class="o">-</span><span class="n">events</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Look for more examples in the <cite>sentry_streams/examples</cite> folder of the repository.</p></li>
</ol>
<hr class="docutils" />
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="what_for.html">The rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_pipeline.html">Building a Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Aggregate"><code class="docutils literal notranslate"><span class="pre">Aggregate</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Batch"><code class="docutils literal notranslate"><span class="pre">Batch</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.BatchParser"><code class="docutils literal notranslate"><span class="pre">BatchParser</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Branch"><code class="docutils literal notranslate"><span class="pre">Branch</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Broadcast"><code class="docutils literal notranslate"><span class="pre">Broadcast</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.ComplexStep"><code class="docutils literal notranslate"><span class="pre">ComplexStep</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.DevNullSink"><code class="docutils literal notranslate"><span class="pre">DevNullSink</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Filter"><code class="docutils literal notranslate"><span class="pre">Filter</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.FlatMap"><code class="docutils literal notranslate"><span class="pre">FlatMap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.FunctionTransform"><code class="docutils literal notranslate"><span class="pre">FunctionTransform</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.GCSSink"><code class="docutils literal notranslate"><span class="pre">GCSSink</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Map"><code class="docutils literal notranslate"><span class="pre">Map</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.ParquetSerializer"><code class="docutils literal notranslate"><span class="pre">ParquetSerializer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Parser"><code class="docutils literal notranslate"><span class="pre">Parser</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Pipeline"><code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Reduce"><code class="docutils literal notranslate"><span class="pre">Reduce</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Reducer"><code class="docutils literal notranslate"><span class="pre">Reducer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Router"><code class="docutils literal notranslate"><span class="pre">Router</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Serializer"><code class="docutils literal notranslate"><span class="pre">Serializer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Sink"><code class="docutils literal notranslate"><span class="pre">Sink</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Source"><code class="docutils literal notranslate"><span class="pre">Source</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Step"><code class="docutils literal notranslate"><span class="pre">Step</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.StepType"><code class="docutils literal notranslate"><span class="pre">StepType</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.StreamSink"><code class="docutils literal notranslate"><span class="pre">StreamSink</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.StreamSource"><code class="docutils literal notranslate"><span class="pre">StreamSource</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.Transform"><code class="docutils literal notranslate"><span class="pre">Transform</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.TransformStep"><code class="docutils literal notranslate"><span class="pre">TransformStep</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.WithInput"><code class="docutils literal notranslate"><span class="pre">WithInput</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.branch"><code class="docutils literal notranslate"><span class="pre">branch()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.make_edge_sets"><code class="docutils literal notranslate"><span class="pre">make_edge_sets()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="build_pipeline.html#sentry_streams.pipeline.pipeline.streaming_source"><code class="docutils literal notranslate"><span class="pre">streaming_source()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configure_pipeline.html">Pipeline runtime configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure_pipeline.html#distribution-and-parallelism">Distribution and parallelism</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configure_pipeline.html#segments">Segments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="runtime/arroyo.html">Arroyo Runtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="runtime/arroyo.html#rust-arroyo-runtime">Rust Arroyo Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="runtime/arroyo.html#routes">Routes</a></li>
<li class="toctree-l2"><a class="reference internal" href="runtime/arroyo.html#watermarks">Watermarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="runtime/arroyo.html#watermark-progress">Watermark Progress</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deploying on Kuberentes</a></li>
<li class="toctree-l1"><a class="reference internal" href="rust.html">Rust applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="rust.html#hybrid-applications">Hybrid applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="rust.html#pure-rust-pipelines">Pure-Rust pipelines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rust.html#meeting-notes-july-24-2025">Meeting notes July 24, 2025</a></li>
</ul>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">Sentry Streams</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="what_for.html">The rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_pipeline.html">Building a Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure_pipeline.html">Pipeline runtime configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure_pipeline.html#distribution-and-parallelism">Distribution and parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime/arroyo.html">Arroyo Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deploying on Kuberentes</a></li>
<li class="toctree-l1"><a class="reference internal" href="rust.html">Rust applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="rust.html#meeting-notes-july-24-2025">Meeting notes July 24, 2025</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="what_for.html" title="next chapter">The rationale</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, blank.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>